import{j as e}from"./vendor-ui-BuaZYnYi.js";import{a as n}from"./vendor-react-C8ngQyMK.js";import{u as R}from"./vendor-charts-CQgSfZ3A.js";import{E as G}from"./vendor-pdf-Dysq3M1X.js";import{g as B,F as w,R as F,P,h as V,i as k,E as W,T as q,X,j as H,k as J,l as K,m as Q}from"./index-BMF47wD1.js";import{F as Y}from"./folder-CIarOFJ3.js";import{S as D}from"./square-pen-BV5nki2E.js";import{F as T}from"./file-down-C_so2dP4.js";import{M as Z,r as _}from"./vendor-markdown-D06ScX5I.js";const de=()=>{const u=R(),[i,L]=n.useState(""),[y,U]=n.useState([]),[d,m]=n.useState(!0),[z,x]=n.useState(!1),[h,f]=n.useState("view"),[r,v]=n.useState(null),[o,g]=n.useState({Nombre:"",Contenido:"",Editor:""}),b=n.useCallback(async()=>{try{m(!0);const s=await u(B("Protocolos")),c=[...(s==null?void 0:s.payload)||[]].sort((l,j)=>{const a=new Date(l.FechaUpdate||0);return new Date(j.FechaUpdate||0)-a});U(c)}catch(s){console.error("Error al cargar protocolos:",s)}finally{m(!1)}},[u]);n.useEffect(()=>{b()},[b]);const C=()=>{f("create"),g({Nombre:"",Contenido:"",Editor:""}),x(!0)},E=s=>{f("edit"),v(s),g({Nombre:s.Nombre||"",Contenido:s.Contenido||"",Editor:s.Editor||""}),x(!0)},M=s=>{f("view"),v(s),x(!0)},O=async s=>{if(window.confirm(`¿Estás seguro de eliminar el protocolo "${s.Nombre}"?`))try{m(!0),await u(J("Protocolos",s.id)),await b()}catch(t){console.error("Error al eliminar:",t),alert("Error al eliminar el protocolo")}finally{m(!1)}},$=async()=>{if(!o.Nombre||!o.Contenido){alert("Por favor completa los campos obligatorios (Nombre y Contenido)");return}try{m(!0);const s={Nombre:o.Nombre.trim(),Contenido:o.Contenido.trim(),Editor:o.Editor.trim()||"Sistema",FechaUpdate:new Date().toISOString()};h==="create"?await u(K("Protocolos",s)):await u(Q("Protocolos",r.id,s)),await b(),x(!1)}catch(s){console.error("Error al guardar:",s),alert("Error al guardar el protocolo")}finally{m(!1)}},S=s=>{const t=new G,c=t.internal.pageSize.getWidth(),l=20,j=c-2*l;let a=20;if(t.setFontSize(18),t.setFont(void 0,"bold"),t.text(s.Nombre,l,a),a+=10,t.setFontSize(10),t.setFont(void 0,"normal"),t.setTextColor(100),s.Editor&&(t.text(`Editado por: ${s.Editor}`,l,a),a+=6),s.FechaUpdate){const N=new Date(s.FechaUpdate).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});t.text(`Actualizado: ${N}`,l,a),a+=6}a+=4,t.setDrawColor(200),t.line(l,a,c-l,a),a+=10,t.setTextColor(0),t.setFontSize(11),t.splitTextToSize(s.Contenido||"",j).forEach(N=>{a>270&&(t.addPage(),a=20),t.text(N,l,a),a+=6});const I=s.Nombre.replace(/[^a-z0-9]/gi,"-").toLowerCase().substring(0,50);t.save(`protocolo-${I}.pdf`)},p=y.filter(s=>(s.Nombre||"").toLowerCase().includes(i.toLowerCase())||(s.Editor||"").toLowerCase().includes(i.toLowerCase())||(s.Contenido||"").toLowerCase().includes(i.toLowerCase()));return d&&y.length===0?e.jsx("div",{className:"h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando protocolos desde Supabase..."})]})}):e.jsxs("div",{className:"h-screen bg-gray-50 p-4 md:p-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto h-full flex flex-col gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 flex items-center gap-3",children:[e.jsx(w,{className:"w-8 h-8 text-blue-600"}),"Protocolos"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Gestión de documentos y procedimientos - Supabase"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:b,disabled:d,className:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",title:"Recargar",children:[e.jsx(F,{className:`w-4 h-4 ${d?"animate-spin":""}`}),"Recargar"]}),e.jsxs("button",{onClick:C,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(P,{className:"w-5 h-5"}),"Nuevo Protocolo"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:i,onChange:s=>L(s.target.value),placeholder:"Buscar protocolos por nombre, editor o contenido...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"mt-3 text-sm text-gray-500",children:[p.length," protocolo",p.length!==1?"s":"",i&&` encontrado${p.length!==1?"s":""}`]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 flex-1 overflow-auto p-6",children:p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-12",children:[e.jsx(Y,{className:"w-16 h-16 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:i?"No se encontraron protocolos":"No hay protocolos"}),e.jsx("p",{className:"text-gray-500 mb-4",children:i?"Intenta con otros términos de búsqueda":"Crea tu primer protocolo para comenzar"}),!i&&e.jsxs("button",{onClick:C,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(P,{className:"w-4 h-4"}),"Crear Primer Protocolo"]})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:p.map(s=>{var t,c;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow bg-white",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s.Nombre}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:[(t=s.Contenido)==null?void 0:t.substring(0,200),((c=s.Contenido)==null?void 0:c.length)>200&&"..."]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[s.Editor&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"w-3 h-3"}),e.jsx("span",{children:s.Editor})]}),s.FechaUpdate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-3 h-3"}),e.jsx("span",{children:new Date(s.FechaUpdate).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric"})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>M(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver protocolo",children:e.jsx(W,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>E(s),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar",children:e.jsx(D,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>S(s),className:"p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Exportar PDF",children:e.jsx(T,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>O(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:e.jsx(q,{className:"w-5 h-5"})})]})]})},s.id)})})})]}),z&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800",children:[h==="view"&&"Ver Protocolo",h==="create"&&"Nuevo Protocolo",h==="edit"&&"Editar Protocolo"]}),e.jsx("button",{onClick:()=>x(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(X,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:h==="view"?e.jsxs("div",{children:[r&&e.jsx("div",{className:"mb-6 pb-4 border-b",children:e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[r.Editor&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Editor:"})," ",r.Editor]})]}),r.FechaUpdate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Actualizado:"})," ",new Date(r.FechaUpdate).toLocaleString("es-CO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}),e.jsx("div",{className:"prose max-w-none",children:e.jsx(Z,{remarkPlugins:[_],children:(r==null?void 0:r.Contenido)||""})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre del Protocolo *"}),e.jsx("input",{type:"text",value:o.Nombre,onChange:s=>g({...o,Nombre:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Ej: Proceso de revisión de proyectos"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Editor / Autor"}),e.jsx("input",{type:"text",value:o.Editor,onChange:s=>g({...o,Editor:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Tu nombre (opcional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contenido (Markdown) *"}),e.jsx("textarea",{value:o.Contenido,onChange:s=>g({...o,Contenido:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 font-mono text-sm",rows:15,placeholder:`# Título del Protocolo

## Sección

Escribe el contenido en formato Markdown...`}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Usa Markdown: # Título, ## Subtítulo, **negrita**, *cursiva*, - listas, etc."})]})]})}),e.jsx("div",{className:"p-6 border-t flex items-center justify-end gap-3",children:h==="view"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>S(r),className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[e.jsx(T,{className:"w-4 h-4"}),"Exportar PDF"]}),e.jsxs("button",{onClick:()=>E(r),className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(D,{className:"w-4 h-4"}),"Editar"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",disabled:d,children:"Cancelar"}),e.jsxs("button",{onClick:$,disabled:d,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[d?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(H,{className:"w-4 h-4"}),d?"Guardando...":"Guardar"]})]})})]})})]})};export{de as default};
