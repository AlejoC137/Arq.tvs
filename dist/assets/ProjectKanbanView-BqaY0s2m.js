import{u as I,r as i,j as e,C as B,P as F,D as L,T as q,g as u,E as z,l as $}from"./index-cawTiIuy.js";import{D as M,C as V,u as y,w as G}from"./xlsx-wyOr0oje.js";const E={PENDIENTE:"Pendiente",EN_PROCESO:"En Progreso",COMPLETADO:"Completado",CANCELADO:"Cancelado",EN_REVISION:"En Revisión",BLOQUEADO:"Bloqueado",APROBACION_REQUERIDA:"Aprobación Requerida",EN_DISENO:"En Diseño",EN_DISCUSION:"En Discusión"},K=n=>({Pendiente:"bg-yellow-100 text-yellow-800","En Progreso":"bg-blue-100 text-blue-800",Completado:"bg-green-100 text-green-800",Cancelado:"bg-red-100 text-red-800","En Revisión":"bg-purple-100 text-purple-800",Bloqueado:"bg-gray-400 text-white","Aprobación Requerida":"bg-orange-100 text-orange-800","En Diseño":"bg-pink-100 text-pink-800","En Discusión":"bg-indigo-100 text-indigo-800"})[n]||"bg-gray-100 text-gray-800",U=n=>n==="Alta"?"border-l-4 border-red-500":n==="Media"?"border-l-4 border-orange-500":n==="Baja"?"border-l-4 border-yellow-500":"border-l-4 border-gray-300",H=()=>{const n=I(),[b,w]=i.useState([]),[f,C]=i.useState([]),[m,P]=i.useState([]),[p,S]=i.useState([]),[h,T]=i.useState([]),[D,N]=i.useState(!1),v={project_id:"",stage_id:"",staff_id:"",status:"",search:""},[l,g]=i.useState(v);i.useEffect(()=>{(async()=>{const[a,r,t,o,d]=await Promise.all([n(u("Tareas")),n(u("Proyectos")),n(u("Staff")),n(u("Stage")),n(u("Entregables_template"))]);a!=null&&a.payload&&w(a.payload),r!=null&&r.payload&&C(r.payload),t!=null&&t.payload&&P(t.payload),o!=null&&o.payload&&S(o.payload),d!=null&&d.payload&&T(d.payload)})()},[n]);const j=i.useMemo(()=>{let s=[...b];if(l.search){const a=l.search.toLowerCase();s=s.filter(r=>Object.values(r).some(t=>String(t).toLowerCase().includes(a)))}return l.project_id&&(s=s.filter(a=>a.project_id===l.project_id)),l.stage_id&&(s=s.filter(a=>a.stage_id===l.stage_id)),l.staff_id&&(s=s.filter(a=>a.staff_id===l.staff_id)),l.status&&(s=s.filter(a=>a.status===l.status)),s},[b,l]),O=i.useMemo(()=>j.reduce((s,a)=>{const r=a.project_id||"unassigned";return s[r]||(s[r]=[]),s[r].push(a),s},{}),[j]),k=s=>{n(z(s))},R=(s,a)=>{window.confirm(`¿Estás seguro de que deseas eliminar la tarea?

"${a}"`)&&n($(s))},A=()=>{const s=j.map(t=>{var o,d,x,_;return{Proyecto:((o=f.find(c=>c.id===t.project_id))==null?void 0:o.name)||"Sin Asignar",Etapa:((d=p.find(c=>c.id===t.stage_id))==null?void 0:d.name)||t.stage_id,Entregable:((x=h.find(c=>c.id===t.entregable_id))==null?void 0:x.entregable_nombre)||t.entregable_id,Tarea:t.task_description,Progreso:`${t.Progress||0}%`,Estado:t.status,Responsable:((_=m.find(c=>c.id===t.staff_id))==null?void 0:_.name)||t.staff_id,Prioridad:t.Priority}}),a=y.json_to_sheet(s),r=y.book_new();y.book_append_sheet(r,a,"Tareas"),G(r,"Gestion_Tareas_Kanban.xlsx")};return e.jsxs(e.Fragment,{children:[e.jsx(B,{isOpen:D,onClose:()=>N(!1),onSubmit:k,proyectos:f,staff:m,stages:p,entregables:h,estados:E}),e.jsxs("div",{className:"flex flex-col h-screen bg-gray-100 font-sans",children:[e.jsxs("header",{className:"bg-white shadow-sm border-b p-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Tareas (Kanban)"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vista de tarjetas por proyecto"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 px-4 py-2 bg-green-600   rounded-lg hover:bg-green-700 text-sm",children:[e.jsx(M,{size:16})," Exportar Vista"]}),e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600   rounded-lg hover:bg-blue-700 text-sm",children:[e.jsx(F,{size:16})," Nueva Tarea"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Búsqueda General"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar en tareas, notas...",value:l.search,onChange:s=>g(a=>({...a,search:s.target.value})),className:"pl-10 w-full p-2 border border-gray-300 rounded-lg text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Etapa"}),e.jsxs("select",{value:l.stage_id,onChange:s=>g(a=>({...a,stage_id:s.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"Todas"}),p.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Responsable"}),e.jsxs("select",{value:l.staff_id,onChange:s=>g(a=>({...a,staff_id:s.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"Todos"}),m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsxs("select",{value:l.status,onChange:s=>g(a=>({...a,status:s.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"Todos"}),Object.values(E).map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:()=>g(v),className:"flex items-center justify-center gap-2 px-4 py-2 bg-gray-600   rounded-lg hover:bg-gray-700 w-full text-sm",children:[e.jsx(V,{size:16})," Limpiar"]})})]})]}),e.jsx("main",{className:"flex-1 overflow-x-auto p-4",children:e.jsx("div",{className:"flex gap-4 h-full",children:Object.entries(O).map(([s,a])=>{const r=f.find(t=>t.id===s);return e.jsxs("div",{className:"flex-shrink-0 w-80 bg-gray-200 rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-3 bg-white border-b rounded-t-lg sticky top-0",children:[e.jsx("h2",{className:"font-bold text-gray-800",children:(r==null?void 0:r.name)||"Tareas sin Proyecto"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.length," ",a.length===1?"tarea":"tareas"]})]}),e.jsx("div",{className:"p-2 overflow-y-auto h-[calc(100%-60px)]",children:a.map(t=>{var o,d;return e.jsxs("div",{className:`bg-white rounded-lg shadow-sm p-3 mb-3 hover:shadow-lg transition-shadow ${U(t.Priority)}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"font-semibold text-sm text-gray-800 break-words mb-2",children:t.task_description}),e.jsx("button",{onClick:()=>R(t.id,t.task_description),className:"text-gray-400 hover:text-red-500 p-1 rounded-full flex-shrink-0",children:e.jsx(q,{size:14})})]}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-2 mb-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Entregable:"})," ",((o=h.find(x=>x.id===t.entregable_id))==null?void 0:o.entregable_nombre)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Responsable:"})," ",((d=m.find(x=>x.id===t.staff_id))==null?void 0:d.name)||"-"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-700 w-9",children:[t.Progress||0,"%"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${t.Progress||0}%`}})})]}),e.jsx("div",{className:"flex justify-start",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${K(t.status)}`,children:t.status})})]},t.id)})})]},s)})})})]})]})};export{H as default};
//# sourceMappingURL=ProjectKanbanView-BqaY0s2m.js.map
