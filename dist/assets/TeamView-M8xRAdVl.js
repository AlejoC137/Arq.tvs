import{c as R,u as O,r,f as $,h as G,i as V,j as e,X,T as H,k as J,l as K,m as Q,n as W,U as A}from"./index-cawTiIuy.js";import{C as v,a as F,B as D}from"./clock-D8SG1aDS.js";/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=R("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=R("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=R("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),M=["Pendiente","En Diseño","En Progreso","Aprobación Requerida","Bloqueado","En Discusión","Completo"],ee=({staff:d,onClose:m})=>{const x=O(),[c,w]=r.useState([]),[p,j]=r.useState([]),[f,b]=r.useState([]),[C,S]=r.useState([]),[N,y]=r.useState(!0),[u,k]=r.useState("all"),[a,l]=r.useState("status"),[E,P]=r.useState(null);r.useEffect(()=>{o()},[d.id,x]),r.useEffect(()=>{n()},[c,u,a]);const o=async()=>{y(!0);try{const[s,t,i]=await Promise.all([x($(d.id)),x(G()),x(V())]);s.success&&w(s.data||[]),t.success&&b(t.data||[]),i.success&&S(i.data||[])}catch(s){console.error("Error loading staff tasks:",s)}finally{y(!1)}},n=()=>{let s=[...c];switch(u!=="all"&&(s=s.filter(t=>t.status===u)),a){case"status":s.sort((t,i)=>{const g=["Bloqueado","Pendiente","En Diseño","En Progreso","Aprobación Requerida","Completo"];return g.indexOf(t.status)-g.indexOf(i.status)});break;case"project":s.sort((t,i)=>{const g=T(t.project_id),B=T(i.project_id);return g.localeCompare(B)});break;case"stage":s.sort((t,i)=>{const g=q(t.stage_id),B=q(i.stage_id);return g.localeCompare(B)});break}j(s)},T=s=>{const t=f.find(i=>i.id===s);return t?t.name:"Sin proyecto"},q=s=>{const t=C.find(i=>i.id===s);return t?t.name:"Sin etapa"},z=async(s,t)=>{(await x(J(s,t))).success&&o()},U=async s=>{window.confirm("¿Estás seguro de eliminar esta tarea?")&&(await x(K(s))).success&&o()},L=s=>{switch(s){case"Completo":return e.jsx(F,{className:"w-4 h-4"});case"Bloqueado":return e.jsx(Z,{className:"w-4 h-4"});case"Pendiente":return e.jsx(v,{className:"w-4 h-4"});default:return e.jsx(v,{className:"w-4 h-4"})}},I=s=>({Pendiente:"bg-gray-100 text-gray-800 border-gray-300","En Diseño":"bg-purple-100 text-purple-800 border-purple-300","En Progreso":"bg-blue-100 text-blue-800 border-blue-300","Aprobación Requerida":"bg-orange-100 text-orange-800 border-orange-300",Bloqueado:"bg-red-100 text-red-800 border-red-300","En Discusión":"bg-yellow-100 text-yellow-800 border-yellow-300",Completo:"bg-green-100 text-green-800 border-green-300"})[s]||"bg-gray-100 text-gray-800 border-gray-300",h={all:c.length,Pendiente:c.filter(s=>s.status==="Pendiente").length,"En Progreso":c.filter(s=>s.status==="En Progreso"||s.status==="En Diseño").length,Completo:c.filter(s=>s.status==="Completo").length,Bloqueado:c.filter(s=>s.status==="Bloqueado").length};return N?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Cargando tareas..."})]})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-full flex items-center justify-center text-blue-600 font-bold text-xl",children:d.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"text-white",children:[e.jsx("h2",{className:"text-2xl font-bold",children:d.name}),e.jsx("p",{className:"text-blue-100",children:d.role_description||"Sin rol"})]})]}),e.jsx("button",{onClick:m,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-colors",children:e.jsx(X,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"bg-gray-50 border-b px-6 py-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Total:"}),e.jsx("span",{className:"ml-2 text-gray-900 font-bold",children:h.all})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Pendientes:"}),e.jsx("span",{className:"ml-2 text-orange-600 font-bold",children:h.Pendiente})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"En Curso:"}),e.jsx("span",{className:"ml-2 text-blue-600 font-bold",children:h["En Progreso"]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Completadas:"}),e.jsx("span",{className:"ml-2 text-green-600 font-bold",children:h.Completo})]}),h.Bloqueado>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Bloqueadas:"}),e.jsx("span",{className:"ml-2 text-red-600 font-bold",children:h.Bloqueado})]})]})})}),e.jsxs("div",{className:"bg-white border-b px-6 py-3 flex items-center space-x-4",children:[e.jsx(Y,{className:"w-5 h-5 text-gray-600"}),e.jsxs("select",{value:u,onChange:s=>k(s.target.value),className:"border rounded-lg px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Todos los estados"}),M.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:a,onChange:s=>l(s.target.value),className:"border rounded-lg px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"status",children:"Ordenar por estado"}),e.jsx("option",{value:"project",children:"Ordenar por proyecto"}),e.jsx("option",{value:"stage",children:"Ordenar por etapa"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No hay tareas que mostrar"})]}):e.jsx("div",{className:"space-y-3",children:p.map(s=>e.jsx("div",{className:"bg-white border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${I(s.status)}`,children:[L(s.status),e.jsx("span",{className:"ml-1",children:s.status})]}),e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:s.category})]}),e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:s.task_description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["📁 ",T(s.project_id)]}),e.jsxs("span",{children:["📋 ",q(s.stage_id)]})]}),s.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2 line-clamp-2",children:s.notes})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{value:s.status,onChange:t=>z(s.id,t.target.value),className:"text-sm border rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500",children:M.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("button",{onClick:()=>U(s.id),className:"p-2 text-red-500 hover:bg-red-50 rounded transition-colors",title:"Eliminar tarea",children:e.jsx(H,{className:"w-4 h-4"})})]})]})},s.id))})}),e.jsx("div",{className:"bg-gray-50 border-t px-6 py-4 flex items-center justify-end",children:e.jsx("button",{onClick:m,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",children:"Cerrar"})})]})})},ae=()=>{const d=O(),[m,x]=r.useState([]),[c,w]=r.useState([]),[p,j]=r.useState(!0),[f,b]=r.useState(null),[C,S]=r.useState({});r.useEffect(()=>{N()},[d]);const N=async()=>{j(!0);try{const[a,l]=await Promise.all([d(Q()),d(W())]);a.success&&x(a.data||[]),l.success&&(w(l.data||[]),y(a.data||[],l.data||[]))}catch(a){console.error("Error loading team data:",a)}finally{j(!1)}},y=(a,l)=>{const E={};a.forEach(P=>{const o=l.filter(n=>n.staff_id===P.id);E[P.id]={total:o.length,pending:o.filter(n=>n.status==="Pendiente").length,inProgress:o.filter(n=>n.status==="En Progreso"||n.status==="En Diseño").length,completed:o.filter(n=>n.status==="Completo").length,blocked:o.filter(n=>n.status==="Bloqueado").length,completionRate:o.length>0?Math.round(o.filter(n=>n.status==="Completo").length/o.length*100):0}}),S(E)},u=a=>{b(a)},k=()=>{b(null),N()};return p?e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando equipo..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(A,{className:"w-8 h-8 text-blue-600"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Equipo de Trabajo"})]}),e.jsx("p",{className:"text-gray-600",children:"Gestión de tareas por miembro del equipo"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Equipo"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:m.length})]}),e.jsx(A,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-orange-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tareas Totales"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:c.length})]}),e.jsx(D,{className:"w-8 h-8 text-orange-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completadas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:c.filter(a=>a.status==="Completo").length})]}),e.jsx(F,{className:"w-8 h-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Bloqueadas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:c.filter(a=>a.status==="Bloqueado").length})]}),e.jsx(_,{className:"w-8 h-8 text-red-500"})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(a=>{const l=C[a.id]||{total:0,pending:0,inProgress:0,completed:0,blocked:0,completionRate:0};return e.jsxs("div",{onClick:()=>u(a),className:"bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 cursor-pointer border-2 border-transparent hover:border-blue-400 overflow-hidden group",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-full flex items-center justify-center text-blue-600 font-bold text-xl",children:a.name?a.name.charAt(0).toUpperCase():"?"}),e.jsxs("div",{className:"flex-1 text-white",children:[e.jsx("h3",{className:"font-bold text-lg truncate",children:a.name}),e.jsx("p",{className:"text-sm text-blue-100 truncate",children:a.role_description||"Sin rol asignado"})]})]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Progreso"}),e.jsxs("span",{className:"text-xs font-bold text-gray-800",children:[l.completionRate,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${l.completionRate}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:l.total}),e.jsx("p",{className:"text-xs text-gray-600",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:l.completed}),e.jsx("p",{className:"text-xs text-gray-600",children:"Completas"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2 border-t",children:[l.pending>0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700",children:[e.jsx(v,{className:"w-3 h-3 mr-1"}),l.pending," Pendiente",l.pending>1?"s":""]}),l.inProgress>0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),l.inProgress," En Curso"]}),l.blocked>0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700",children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),l.blocked," Bloqueada",l.blocked>1?"s":""]})]})]}),e.jsx("div",{className:"bg-gray-50 px-4 py-2 text-center group-hover:bg-blue-50 transition-colors",children:e.jsx("p",{className:"text-sm text-gray-600 group-hover:text-blue-600 font-medium",children:"Click para ver tareas →"})})]},a.id)})}),m.length===0&&!p&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-600 mb-2",children:"No hay miembros del equipo"}),e.jsx("p",{className:"text-gray-500",children:"Agrega miembros para comenzar a gestionar tareas"})]})]}),f&&e.jsx(ee,{staff:f,onClose:k})]})};export{ae as default};
//# sourceMappingURL=TeamView-M8xRAdVl.js.map
