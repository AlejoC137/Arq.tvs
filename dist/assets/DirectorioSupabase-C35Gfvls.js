import{j as e}from"./vendor-ui-BuaZYnYi.js";import{a as l}from"./vendor-react-C8ngQyMK.js";import{u as I}from"./vendor-charts-CQgSfZ3A.js";import{E as S}from"./vendor-pdf-Dysq3M1X.js";import{g as M,U as E,R as k,P as D,h as R,E as G,T as O,X as q,j as V,k as W,l as Y,m as B}from"./index-BMF47wD1.js";import{F as j}from"./file-down-C_so2dP4.js";import{S as F}from"./square-pen-BV5nki2E.js";const ee=()=>{const x=I(),[n,T]=l.useState(""),[u,P]=l.useState([]),[i,c]=l.useState(!0),[z,d]=l.useState(!1),[m,p]=l.useState("view"),[a,y]=l.useState(null),[r,g]=l.useState({Nombre:"",Contacto:"",Cargo:""}),h=l.useCallback(async()=>{try{c(!0);const t=await x(M("Directorio")),o=[...(t==null?void 0:t.payload)||[]].sort((f,N)=>(f.Nombre||"").localeCompare(N.Nombre||""));P(o)}catch(t){console.error("Error al cargar contactos:",t)}finally{c(!1)}},[x]);l.useEffect(()=>{h()},[h]);const v=()=>{p("create"),g({Nombre:"",Contacto:"",Cargo:""}),d(!0)},w=t=>{p("edit"),y(t),g({Nombre:t.Nombre||"",Contacto:t.Contacto||"",Cargo:t.Cargo||""}),d(!0)},A=t=>{p("view"),y(t),d(!0)},L=async t=>{if(window.confirm(`¿Estás seguro de eliminar a ${t.Nombre}?`))try{c(!0),await x(W("Directorio",t.id)),await h()}catch(s){console.error("Error al eliminar:",s),alert("Error al eliminar el contacto")}finally{c(!1)}},$=async()=>{if(!r.Nombre||!r.Contacto){alert("Por favor completa los campos obligatorios (Nombre y Contacto)");return}try{c(!0);const t={Nombre:r.Nombre.trim(),Contacto:r.Contacto.trim(),Cargo:r.Cargo.trim()};m==="create"?await x(Y("Directorio",t)):await x(B("Directorio",a.id,t)),await h(),d(!1)}catch(t){console.error("Error al guardar:",t),alert("Error al guardar el contacto")}finally{c(!1)}},U=()=>{const t=new S;t.setFontSize(20),t.setFont(void 0,"bold"),t.text("Directorio de Contactos",20,20),t.setFontSize(10),t.setFont(void 0,"normal"),t.setTextColor(100),t.text(`Generado: ${new Date().toLocaleDateString("es-CO")}`,20,28),t.text(`Total contactos: ${u.length}`,20,33);const s=u.map(o=>[o.Nombre||"",o.Contacto||"",o.Cargo||""]);t.autoTable({startY:40,head:[["Nombre","Contacto","Cargo"]],body:s,theme:"striped",styles:{fontSize:10},headStyles:{fillColor:[59,130,246]},columnStyles:{0:{cellWidth:60},1:{cellWidth:70},2:{cellWidth:60}}}),t.save(`directorio-${new Date().toISOString().split("T")[0]}.pdf`)},C=t=>{const s=new S;let o=20;s.setFontSize(18),s.setFont(void 0,"bold"),s.text(t.Nombre||"Sin nombre",20,o),o+=10,s.setFontSize(12),s.setFont(void 0,"normal");const f=[[`Contacto: ${t.Contacto||"N/A"}`],[`Cargo: ${t.Cargo||"N/A"}`]];s.autoTable({startY:o,body:f,theme:"plain",styles:{fontSize:12}});const N=(t.Nombre||"contacto").replace(/[^a-z0-9]/gi,"-").toLowerCase().substring(0,50);s.save(`contacto-${N}.pdf`)},b=u.filter(t=>(t.Nombre||"").toLowerCase().includes(n.toLowerCase())||(t.Cargo||"").toLowerCase().includes(n.toLowerCase())||(t.Contacto||"").toLowerCase().includes(n.toLowerCase()));return i&&u.length===0?e.jsx("div",{className:"h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando directorio desde Supabase..."})]})}):e.jsxs("div",{className:"h-screen bg-gray-50 p-4 md:p-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto h-full flex flex-col gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 flex items-center gap-3",children:[e.jsx(E,{className:"w-8 h-8 text-blue-600"}),"Directorio"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Gestión de contactos y colaboradores - Supabase"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:h,disabled:i,className:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",title:"Recargar",children:[e.jsx(k,{className:`w-4 h-4 ${i?"animate-spin":""}`}),"Recargar"]}),e.jsxs("button",{onClick:U,className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(j,{className:"w-4 h-4"}),"Exportar Todo"]}),e.jsxs("button",{onClick:v,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(D,{className:"w-5 h-5"}),"Nuevo Contacto"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:n,onChange:t=>T(t.target.value),placeholder:"Buscar por nombre, contacto o cargo...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"mt-3 text-sm text-gray-500",children:[b.length," contacto",b.length!==1?"s":"",n&&` encontrado${b.length!==1?"s":""}`]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 flex-1 overflow-auto p-6",children:b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-12",children:[e.jsx(E,{className:"w-16 h-16 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:n?"No se encontraron contactos":"No hay contactos"}),e.jsx("p",{className:"text-gray-500 mb-4",children:n?"Intenta con otros términos de búsqueda":"Agrega tu primer contacto para comenzar"}),!n&&e.jsxs("button",{onClick:v,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(D,{className:"w-4 h-4"}),"Agregar Primer Contacto"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-lg transition-all bg-white relative group",children:[e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>A(t),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700",title:"Ver",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>w(t),className:"p-1.5 bg-green-600 text-white rounded hover:bg-green-700",title:"Editar",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(t),className:"p-1.5 bg-purple-600 text-white rounded hover:bg-purple-700",title:"PDF",children:e.jsx(j,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>L(t),className:"p-1.5 bg-red-600 text-white rounded hover:bg-red-700",title:"Eliminar",children:e.jsx(O,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold text-lg flex-shrink-0",children:(t.Nombre||"U").charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 truncate",children:t.Nombre||"Sin nombre"}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:t.Cargo||"Sin cargo"})]})]}),e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-line",children:t.Contacto})]},t.id))})})]}),z&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800",children:[m==="view"&&"Ver Contacto",m==="create"&&"Nuevo Contacto",m==="edit"&&"Editar Contacto"]}),e.jsx("button",{onClick:()=>d(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:m==="view"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold text-3xl",children:((a==null?void 0:a.Nombre)||"U").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:a==null?void 0:a.Nombre}),e.jsx("p",{className:"text-lg text-gray-600",children:a==null?void 0:a.Cargo})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Contacto"}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg text-gray-800 whitespace-pre-line",children:a==null?void 0:a.Contacto})]})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre *"}),e.jsx("input",{type:"text",value:r.Nombre,onChange:t=>g({...r,Nombre:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Ej: Juan Pérez"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cargo"}),e.jsx("input",{type:"text",value:r.Cargo,onChange:t=>g({...r,Cargo:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Ej: Arquitecto"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contacto *"}),e.jsx("textarea",{rows:8,value:r.Contacto,onChange:t=>g({...r,Contacto:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Teléfono, email, notas, etc."})]})]})})}),e.jsx("div",{className:"p-6 border-t flex items-center justify-end gap-3",children:m==="view"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>C(a),className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[e.jsx(j,{className:"w-4 h-4"}),"Exportar PDF"]}),e.jsxs("button",{onClick:()=>w(a),className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(F,{className:"w-4 h-4"}),"Editar"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",disabled:i,children:"Cancelar"}),e.jsxs("button",{onClick:$,disabled:i,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[i?e.jsx(k,{className:"w-4 h-4 animate-spin"}):e.jsx(V,{className:"w-4 h-4"}),i?"Guardando...":"Guardar"]})]})})]})})]})};export{ee as default};
