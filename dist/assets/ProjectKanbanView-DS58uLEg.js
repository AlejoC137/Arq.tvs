import{j as e}from"./vendor-ui-BuaZYnYi.js";import{a as d}from"./vendor-react-C8ngQyMK.js";import{u as I}from"./vendor-charts-CQgSfZ3A.js";import{u as y,w as B}from"./vendor-xlsx-3SA47z_C.js";import{n as F,P as L,h as q,T as z,g as m,o as $,p as M}from"./index-BMF47wD1.js";import{D as V,C as G}from"./download-BW2qnULZ.js";import"./vendor-pdf-Dysq3M1X.js";const E={PENDIENTE:"Pendiente",EN_PROCESO:"En Progreso",COMPLETADO:"Completado",CANCELADO:"Cancelado",EN_REVISION:"En Revisión",BLOQUEADO:"Bloqueado",APROBACION_REQUERIDA:"Aprobación Requerida",EN_DISENO:"En Diseño",EN_DISCUSION:"En Discusión"},K=o=>({Pendiente:"bg-yellow-100 text-yellow-800","En Progreso":"bg-blue-100 text-blue-800",Completado:"bg-green-100 text-green-800",Cancelado:"bg-red-100 text-red-800","En Revisión":"bg-purple-100 text-purple-800",Bloqueado:"bg-gray-400 text-white","Aprobación Requerida":"bg-orange-100 text-orange-800","En Diseño":"bg-pink-100 text-pink-800","En Discusión":"bg-indigo-100 text-indigo-800"})[o]||"bg-gray-100 text-gray-800",U=o=>o==="Alta"?"border-l-4 border-red-500":o==="Media"?"border-l-4 border-orange-500":o==="Baja"?"border-l-4 border-yellow-500":"border-l-4 border-gray-300",ee=()=>{const o=I(),[p,w]=d.useState([]),[f,C]=d.useState([]),[u,P]=d.useState([]),[b,S]=d.useState([]),[h,T]=d.useState([]),[D,N]=d.useState(!1),v={project_id:"",stage_id:"",staff_id:"",status:"",search:""},[l,g]=d.useState(v);d.useEffect(()=>{(async()=>{const[a,r,t,n,i]=await Promise.all([o(m("Tareas")),o(m("Proyectos")),o(m("Staff")),o(m("Stage")),o(m("Entregables_template"))]);a!=null&&a.payload&&w(a.payload),r!=null&&r.payload&&C(r.payload),t!=null&&t.payload&&P(t.payload),n!=null&&n.payload&&S(n.payload),i!=null&&i.payload&&T(i.payload)})()},[o]);const j=d.useMemo(()=>{let s=[...p];if(l.search){const a=l.search.toLowerCase();s=s.filter(r=>Object.values(r).some(t=>String(t).toLowerCase().includes(a)))}return l.project_id&&(s=s.filter(a=>a.project_id===l.project_id)),l.stage_id&&(s=s.filter(a=>a.stage_id===l.stage_id)),l.staff_id&&(s=s.filter(a=>a.staff_id===l.staff_id)),l.status&&(s=s.filter(a=>a.status===l.status)),s},[p,l]),O=d.useMemo(()=>j.reduce((s,a)=>{const r=a.project_id||"unassigned";return s[r]||(s[r]=[]),s[r].push(a),s},{}),[j]),k=s=>{o($(s))},R=(s,a)=>{window.confirm(`¿Estás seguro de que deseas eliminar la tarea?

"${a}"`)&&o(M(s))},A=()=>{const s=j.map(t=>{var n,i,x,_;return{Proyecto:((n=f.find(c=>c.id===t.project_id))==null?void 0:n.name)||"Sin Asignar",Etapa:((i=b.find(c=>c.id===t.stage_id))==null?void 0:i.name)||t.stage_id,Entregable:((x=h.find(c=>c.id===t.entregable_id))==null?void 0:x.entregable_nombre)||t.entregable_id,Tarea:t.task_description,Progreso:`${t.Progress||0}%`,Estado:t.status,Responsable:((_=u.find(c=>c.id===t.staff_id))==null?void 0:_.name)||t.staff_id,Prioridad:t.Priority}}),a=y.json_to_sheet(s),r=y.book_new();y.book_append_sheet(r,a,"Tareas"),B(r,"Gestion_Tareas_Kanban.xlsx")};return e.jsxs(e.Fragment,{children:[e.jsx(F,{isOpen:D,onClose:()=>N(!1),onSubmit:k,proyectos:f,staff:u,stages:b,entregables:h,estados:E}),e.jsxs("div",{className:"flex flex-col h-screen bg-gray-100 font-sans",children:[e.jsxs("header",{className:"bg-white shadow-sm border-b p-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Tareas (Kanban)"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vista de tarjetas por proyecto"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 px-4 py-2 bg-green-600   rounded-lg hover:bg-green-700 text-sm",children:[e.jsx(V,{size:16})," Exportar Vista"]}),e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600   rounded-lg hover:bg-blue-700 text-sm",children:[e.jsx(L,{size:16})," Nueva Tarea"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Búsqueda General"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar en tareas, notas...",value:l.search,onChange:s=>g(a=>({...a,search:s.target.value})),className:"pl-10 w-full p-2 border border-gray-300 rounded-lg text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Etapa"}),e.jsxs("select",{value:l.stage_id,onChange:s=>g(a=>({...a,stage_id:s.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"Todas"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Responsable"}),e.jsxs("select",{value:l.staff_id,onChange:s=>g(a=>({...a,staff_id:s.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"Todos"}),u.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsxs("select",{value:l.status,onChange:s=>g(a=>({...a,status:s.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"Todos"}),Object.values(E).map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:()=>g(v),className:"flex items-center justify-center gap-2 px-4 py-2 bg-gray-600   rounded-lg hover:bg-gray-700 w-full text-sm",children:[e.jsx(G,{size:16})," Limpiar"]})})]})]}),e.jsx("main",{className:"flex-1 overflow-x-auto p-4",children:e.jsx("div",{className:"flex gap-4 h-full",children:Object.entries(O).map(([s,a])=>{const r=f.find(t=>t.id===s);return e.jsxs("div",{className:"flex-shrink-0 w-80 bg-gray-200 rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-3 bg-white border-b rounded-t-lg sticky top-0",children:[e.jsx("h2",{className:"font-bold text-gray-800",children:(r==null?void 0:r.name)||"Tareas sin Proyecto"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.length," ",a.length===1?"tarea":"tareas"]})]}),e.jsx("div",{className:"p-2 overflow-y-auto h-[calc(100%-60px)]",children:a.map(t=>{var n,i;return e.jsxs("div",{className:`bg-white rounded-lg shadow-sm p-3 mb-3 hover:shadow-lg transition-shadow ${U(t.Priority)}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"font-semibold text-sm text-gray-800 break-words mb-2",children:t.task_description}),e.jsx("button",{onClick:()=>R(t.id,t.task_description),className:"text-gray-400 hover:text-red-500 p-1 rounded-full flex-shrink-0",children:e.jsx(z,{size:14})})]}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-2 mb-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Entregable:"})," ",((n=h.find(x=>x.id===t.entregable_id))==null?void 0:n.entregable_nombre)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Responsable:"})," ",((i=u.find(x=>x.id===t.staff_id))==null?void 0:i.name)||"-"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-700 w-9",children:[t.Progress||0,"%"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${t.Progress||0}%`}})})]}),e.jsx("div",{className:"flex justify-start",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${K(t.status)}`,children:t.status})})]},t.id)})})]},s)})})})]})]})};export{ee as default};
